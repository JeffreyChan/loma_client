(function(){if(!String.prototype.format){String.prototype.format=function(){var t=arguments;return this.replace(/{(\d+)}/g,function(e,o){return typeof t[o]!="undefined"?t[o]:e})}}if(!Array.prototype.getIndexBy){Array.prototype.getIndexBy=function(t,e){for(var o=0;o<this.length;o++){if(this[o][t]==e){return o}}return-1}}angular.module("underscore",[]);angular.module("underscore").factory("_",["$window",function(t){return t._}]);var t=angular.module("lomaApp",["underscore","ngRoute","ngSanitize","ui.bootstrap","ngMessages","ui-notification"]);function e(t,e,o,r){t.when("/",{templateUrl:"/tmp/home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/category-list",{templateUrl:"/tmp/category/list.view.html",controller:"categoryCtrl",controllerAs:"vm"}).when("/question-list",{templateUrl:"/tmp/question/list.view.html",controller:"questionCtrl",controllerAs:"vm"}).when("/exam",{templateUrl:"/tmp/exam/index.view.html",controller:"examCtrl",controllerAs:"vm"}).when("/record-list",{templateUrl:"/tmp/record/list.view.html",controller:"recordCtrl",controllerAs:"vm"}).when("/register",{template:"<h1>hell</h1>"}).when("/login",{template:"<h1>hell</h1>"}).otherwise({redirectTo:"/"});e.html5Mode(true);r.setOptions({delay:3e3,startTop:20,startRight:10,verticalSpacing:20,horizontalSpacing:20,positionX:"center",positionY:"top"})}t.value("LOMA_CONFIG",{rootUrl:"http://localhost:2000"});t.config(["$routeProvider","$locationProvider","$httpProvider","NotificationProvider",e])})();(function(){angular.module("lomaApp").controller("dashboradCtrl",t);t.$inject=["$scope"];function t(t){t.loadingView=true;console.log("hello DashBorad")}})();(function(){angular.module("lomaApp").controller("homeCtrl",t);t.$inject=["$scope"];function t(t){if(window.location.pathname!=="/"){window.location.href="/#"+window.location.pathname}var e=this;e.message="yes";console.log("hello world")}})();(function(){angular.module("lomaApp").controller("categoryCtrl",t);t.$inject=["$scope","$uibModal","commonService","popupService","categoryService","$timeout","Notification"];function t(t,e,o,r,n,a,i){var s=this;s.showNumEntries=[10,25,50,100];s.pageCount=s.showNumEntries[0];s.currentPage=1;s.totalItems=0;s.pageMaxSize=10;s.initCategoryList=function(t,e){n.getCategoryList(t,e).success(function(t){if(o.isEmptyOrNull(t.entity)){i.error({message:"No category found!",delay:5e3})}s.totalItems=t.entity.totalNum;s.catListData=t.entity.data||[];s.pageStart=(s.currentPage-1)*s.pageCount+1;var e=s.pageStart+s.pageCount-1;s.pageEnd=e<s.totalItems?e:s.totalItems}).error(function(t){i.error({message:"Sorry, something's gone wrong, please try again later",delay:5e3})})};t.$watch("vm.pageCount",function(){s.initCategoryList(s.currentPage,s.pageCount)});s.pageChanged=function(){s.initCategoryList(s.currentPage,s.pageCount)};s.delayInfo=function(e){t.$apply(function(){s.infoMessage=e})};s.popupremoveForm=function(t){var e={closeButtonText:"Cancel",okButtonText:"Confirm",headerText:"Delete Category",bodyText:"Are you sure you want to delete this category?",entityId:t};r.showModal({},e).then(function(t){n.removeCategory(e.entityId).success(function(t){a(function(){s.initCategoryList(s.currentPage,s.pageCount)},500);i.success("Delete category successfully")}).error(function(t){i.error({message:t.error,delay:5e3})})})};s.popupCreateOrUpdateForm=function(t){t=t||"";var e=_.find(s.catListData,function(e){return _.isEqual(e._id,t)})||{};var n={closeButtonText:"Cancel",okButtonText:"Sumbit",headerText:o.isEmptyOrNull(t)?"Create Category":"Update Category",bodyText:"",isCreateFlag:o.isEmptyOrNull(t)};var c={templateUrl:"tmp/category/updatecreate.view.html",controller:"catCreateOrUpdateCtrl",controllerAs:"vm",resolve:{modalData:function(){return{options:n,entity:{_id:e._id,name:e.name,desc:e.desc,parent:e.parent}}}}};r.showModal(c,n).then(function(t){var e=n.isCreateFlag?"Create Category done!":"Update Category done!";i.success(e);a(function(){s.initCategoryList(s.currentPage,s.pageCount)},500)})}}})();(function(){angular.module("lomaApp").controller("catCreateOrUpdateCtrl",t);t.$inject=["$scope","commonService","$uibModalInstance","modalData","categoryService","popupService"];function t(t,e,o,r,n,a){var i=this;i.catList=[];i.modalData=r;i.formData=i.modalData.entity||{};i.isCreateFlag=e.isEmptyOrNull(i.formData._id);i.formError="";n.getRootCategory().success(function(t){i.catList=t.entity;i.formData.parent=i.catList[0]._id}).error(function(t){i.formError="Sorry, something's gone wrong, please try again later"});i.modal={ok:function(t){o.close(t)},cancel:function(){o.dismiss("cancel")}};i.onSubmit=function(){t.$broadcast("show-errors-check-validity");if(t.categoryForm.$invalid){return}if(i.isCreateFlag){i.doAddCategory(i.formData)}else{i.doUpdateCategory(i.formData)}};i.doUpdateCategory=function(t){n.updateCategory(t).success(function(t){i.modal.ok(t.entity)}).error(function(t){i.formError=t.error});return false};i.doAddCategory=function(t){n.createCategory(t).success(function(t){i.modal.ok(t.entity)}).error(function(t){i.formError=t.error});return false}}})();(function(){angular.module("lomaApp").controller("questionCtrl",t);t.$inject=["$scope","$uibModal","commonService","popupService","categoryService","questionService","$timeout","Notification"];function t(t,e,o,r,n,a,i,s){var c=this;c.showNumEntries=[10,25,50,100];c.pageCount=c.showNumEntries[0];c.currentPage=1;c.totalItems=0;c.pageMaxSize=10;c.initQuestionList=function(t,e){a.getQuestionList(t,e).success(function(t){if(o.isEmptyOrNull(t.entity)){s.error({message:"No question found!",delay:5e3})}c.totalItems=t.entity.totalNum;c.questionData=t.entity.data||[];c.pageStart=(c.currentPage-1)*c.pageCount+1;var e=c.pageStart+c.pageCount-1;c.pageEnd=e<c.totalItems?e:c.totalItems}).error(function(t){s.error({message:"Sorry, something's gone wrong, please try again later",delay:5e3})})};t.$watch("vm.pageCount",function(){c.initQuestionList(c.currentPage,c.pageCount)});c.pageChanged=function(){c.initQuestionList(c.currentPage,c.pageCount)};c.delayInfo=function(e){t.$apply(function(){c.infoMessage=e})};c.popupremoveForm=function(t){var e={closeButtonText:"Cancel",okButtonText:"Confirm",headerText:"Delete question",bodyText:"Are you sure you want to delete this question?"};r.showModal({},e).then(function(e){a.removeQuestion(t).success(function(t){i(function(){c.initQuestionList(c.currentPage,c.pageCount)},500);s.success("Delete question successfully")}).error(function(t){s.error({message:t.error,delay:5e3})})})};c.popupCreateForm=function(){var t={closeButtonText:"Cancel",okButtonText:"Sumbit",headerText:"Create Question"};var e={templateUrl:"tmp/question/create.view.html",controller:"quesCreateCtrl",controllerAs:"vm",resolve:{modalData:function(){return{options:t}}}};r.showModal(e,t).then(function(t){var e="Create Question done!";s.success(e);i(function(){c.initQuestionList(c.currentPage,c.pageCount)},500)})};c.popupUpdateForm=function(t){t=t||"";var e={closeButtonText:"Cancel",okButtonText:"Sumbit",headerText:"update Question"};var o={templateUrl:"tmp/question/update.view.html",controller:"quesUpdateCtrl",controllerAs:"vm",resolve:{modalData:function(){return{options:e,questionId:t}}}};r.showModal(o,e).then(function(t){var e="Update Question done!";s.success(e);i(function(){c.initQuestionList(c.currentPage,c.pageCount)},500)})}}})();(function(){angular.module("lomaApp").controller("quesCreateCtrl",t);t.$inject=["_","$scope","modalData","commonService","$uibModalInstance","categoryService","questionService","popupService"];function t(t,e,o,r,n,a,i,s){var c=this;c.modalData=o;c.formError="";c.formData={};c.answerOptions=[{answer:"",isCorrect:false},{answer:"",isCorrect:false},{answer:"",isCorrect:false},{answer:"",isCorrect:false}];a.getchildCategory().success(function(t){c.catList=t.entity;c.formData.category=c.catList[0]._id}).error(function(t){c.formError="Sorry, something's gone wrong, please try again later"});c.modal={ok:function(t){n.close(t)},cancel:function(){n.dismiss("cancel")}};c.onSubmit=function(){c.formError="";e.$broadcast("show-errors-check-validity");if(e.questionForm.$invalid){return}var o=t.countBy(c.answerOptions,function(t){return t.isCorrect?"Right":"Wrong"});if(o["Right"]!==1){c.formError="the question's option must have only one right answer!";return}c.formData.options=c.answerOptions;c.doAddQuestion(c.formData)};c.doAddQuestion=function(t){i.createQuestion(t).success(function(t){c.modal.ok(t.entity)}).error(function(t){c.formError=t.error});return false}}})();(function(){angular.module("lomaApp").controller("quesUpdateCtrl",t);t.$inject=["_","$scope","$timeout","modalData","commonService","$uibModalInstance","categoryService","questionService","popupService"];function t(t,e,o,r,n,a,i,s,c){var u=this;u.formData={};u.answerOptions=[];u.popupOptionForm=function(e,r){e=e||"";var n={closeButtonText:"Cancel",okButtonText:"Sumbit",headerText:"update Question Option"};var a=t.find(u.formData.options,function(o){return t.isEqual(e,o._id)});var i={templateUrl:"tmp/question/option.view.html",controller:"optionCtrl",controllerAs:"vm",resolve:{modalData:function(){return{options:n,option:{_id:a._id,answer:a.answer}}}}};c.showModal(i,n).then(function(t){u.formInfo="Update Question Option done!";o(function(){u.answerOptions[r]=t},500)})};u.doGetQuestion=function(e){s.getQuestionById(e).success(function(e){u.doGetChildCategory();t.each(e.entity.options,function(t){u.answerOptions.push(t)});u.formData=e.entity}).error(function(t){u.formError=t.error})};u.doGetChildCategory=function(){i.getchildCategory().success(function(t){u.catList=t.entity}).error(function(t){u.formError="Sorry, something's gone wrong, please try again later"})};u.doUpdateQuestion=function(t){s.updateQuestion(t).success(function(t){u.modal.ok(t.entity)}).error(function(t){u.formError=t.error});return false};u.onSubmit=function(){u.formError="";e.$broadcast("show-errors-check-validity");if(e.questionForm.$invalid){return}var o=t.countBy(u.answerOptions,function(t){return t.isCorrect?"Right":"Wrong"});if(o["Right"]!==1){u.formError="the question's option must have only one right answer!";return}u.formData.options=u.answerOptions;u.doUpdateQuestion(u.formData)};u.modalData=r;u.formError="";u.doGetQuestion(u.modalData.questionId);u.modal={ok:function(t){a.close(t)},cancel:function(){a.dismiss("cancel")}}}})();(function(){angular.module("lomaApp").controller("optionCtrl",t);t.$inject=["_","$scope","modalData","commonService","$uibModalInstance","questionService"];function t(t,e,o,r,n,a){var i=this;i.doUpdateOption=function(t){a.updateOption(t).success(function(t){i.modal.ok(t.entity)}).error(function(t){i.formError=t.error});return false};i.onSubmit=function(){i.formError="";e.$broadcast("show-errors-check-validity");if(e.optionForm.$invalid){return}i.doUpdateOption(i.formData)};i.formData={};i.modalData=o;i.formData=i.modalData.option;i.modal={ok:function(t){n.close(t)},cancel:function(){n.dismiss("cancel")}}}})();(function(){angular.module("lomaApp").controller("examCtrl",t);t.$inject=["_","$scope","Notification","categoryService","popupService"];function t(t,e,o,r,n){var a=this;a.formData={};a.formData.userName="cdjboy";a.onSubmit=function(){a.formError="";e.$broadcast("show-errors-check-validity");if(e.examForm.$invalid){return}a.popupExamForm()};a.doGetChildCategory=function(){r.getchildCategory().success(function(t){a.catList=t.entity;a.formData.category=a.catList[0]._id}).error(function(t){a.formError="Sorry, something's gone wrong, please try again later"})};a.popupExamForm=function(){var e={closeButtonText:"Cancel",okButtonText:"Confirm",headerText:"LOMA Online Testing"};var r={templateUrl:"tmp/exam/examDialog.view.html",windowClass:"examModal",controller:"examDialogCtrl",controllerAs:"vm",resolve:{modalData:function(){return{options:e,categoryId:a.formData.category,categoryName:t.find(a.catList,function(e){return t.isEqual(e._id,a.formData.category)}).name,username:a.formData.userName}}}};n.showModal(r,e).then(function(t){var e="Your Exam done!";o.success(e)})};a.doGetChildCategory()}})();(function(){angular.module("lomaApp").controller("examDialogCtrl",t);t.$inject=["_","$scope","$timeout","modalData","commonService","$uibModalInstance","categoryService","questionService","examService","popupService"];function t(t,e,o,r,n,a,i,s,c,u){var l=this;l.modalData=r;l.formError="";l.formData={};l.windowsCount=6;l.onSubmit=function(){l.formError="";var e=t.countBy(l.questionList,function(e){return t.find(e.options,function(t){return t.isCorrect})?"answer":"noanswer"});if(e.noanswer>0){l.formError="You have {0} questions need to answer!".format(e.noanswer);return}var o={user:l.modalData.username,category:l.modalData.categoryId,answerQuestions:[]};var r=t.map(l.questionList,function(e){return{Q:e._id,A:t.find(e.options,function(t){return t.isCorrect})._id}});o.answerQuestions=r;l.doCreateExamRecord(o)};l.modal={ok:function(t){a.close(t)},cancel:function(){a.dismiss("cancel")}};l.doGetExamQuestion=function(){c.getQuestionsByCategory(l.modalData.categoryId).success(function(e){l.questionList=e.entity;l.windowQuestionList=t.chain(l.questionList).groupBy(function(t,e){return Math.floor(e/l.windowsCount)}).toArray().value();u.closeDialog()}).error(function(t){u.closeDialog();l.formError="Sorry, something's gone wrong, please try again later"})};l.doCreateExamRecord=function(t){c.createExamRecord(t).success(function(t){l.modal.ok(t.entity)}).error(function(t){l.formError=t.error});return false};u.showDialog();o(function(){l.doGetExamQuestion()},1500)}})();(function(){angular.module("lomaApp").controller("recordCtrl",t);t.$inject=["$scope","commonService","examService","popupService","$timeout"];function t(t,e,o,r,n){var a=this;a.showNumEntries=[10,25,50,100];a.pageCount=a.showNumEntries[0];a.currentPage=1;a.totalItems=0;a.pageMaxSize=10;a.popupReviewForm=function(t){var e={closeButtonText:"Cancel",okButtonText:"Confirm",headerText:"LOMA Online Testing"};var o={templateUrl:"tmp/record/review.view.html",windowClass:"examModal",controller:"examReviewCtrl",controllerAs:"vm",resolve:{modalData:function(){return{options:e,record:t}}}};r.showModal(o,e).then(function(t){})};a.initRecordsList=function(t,r){o.getExamRecords(t,r).success(function(t){if(e.isEmptyOrNull(t.entity)){Notification.error({message:"No question found!",delay:5e3})}a.totalItems=t.entity.totalNum;a.recordsData=t.entity.data||[];a.pageStart=(a.currentPage-1)*a.pageCount+1;var o=a.pageStart+a.pageCount-1;a.pageEnd=o<a.totalItems?o:a.totalItems}).error(function(t){Notification.error({message:"Sorry, something's gone wrong, please try again later",delay:5e3})})};t.$watch("vm.pageCount",function(){a.initRecordsList(a.currentPage,a.pageCount)});a.pageChanged=function(){a.initRecordsList(a.currentPage,a.pageCount)}}})();(function(){angular.module("lomaApp").controller("examReviewCtrl",t);t.$inject=["_","$scope","$timeout","modalData","commonService","$uibModalInstance","examService","popupService"];function t(t,e,o,r,n,a,i,s){var c=this;c.modalData=r;c.formError="";c.formData={};c.windowsCount=6;c.modal={ok:function(t){a.close(t)},cancel:function(){a.dismiss("cancel")}};c.findAnswerIndex=function(e){var o=t.find(c.formData.examrecord.answerQuestions,function(o){return t.isEqual(o.Q,e)}).A;var r=t.find(c.formData.questions,function(o){return t.isEqual(o._id,e)});return r.options.getIndexBy("_id",o)+1};c.IsCorrect=function(e){var o=t.find(c.formData.examrecord.answerQuestions,function(o){return t.isEqual(o.Q,e)}).A;var r=t.find(c.formData.questions,function(o){return t.isEqual(o._id,e)});return t.isEqual(r.correct,o)};c.doGetReviewRcord=function(){i.getReviewRcord(c.modalData.record._id).success(function(e){c.formData=e.entity;c.windowQuestionList=t.chain(c.formData.questions).groupBy(function(t,e){return Math.floor(e/c.windowsCount)}).toArray().value();s.closeDialog()}).error(function(t){s.closeDialog();c.formError="Sorry, something's gone wrong, please try again later"})};s.showDialog();o(function(){c.doGetReviewRcord()},1500)}})();(function(){angular.module("lomaApp").directive("showErrors",t);t.$inject=["$timeout","$compile"];function t(t,e){return{restrict:"A",require:"^form",link:function(e,o,r,n){var a=o[0].querySelector("[name]");var i=angular.element(a);var s=i.attr("name");var c=false;i.bind("blur",function(){c=true;o.toggleClass("has-error",n[s].$invalid)});e.$watch(function(){return n[s].$invalid},function(t){if(!c&&t){return}o.toggleClass("has-error",t)});e.$on("show-errors-check-validity",function(){o.toggleClass("has-error",n[s].$invalid)});e.$on("show-errors-reset",function(){t(function(){o.removeClass("has-error")},0,false)})}}}})();(function(){angular.module("lomaApp").service("categoryService",t);t.$inject=["$http","LOMA_CONFIG"];function t(t,e){var o=function(o,r){o=o||1;r=r||10;return t.get("{0}/{1}?page={2}&size={3}".format(e.rootUrl,"api/category",o,r))};var r=function(){return t.get("{0}/{1}".format(e.rootUrl,"api/category/root"))};var n=function(){return t.get("{0}/{1}".format(e.rootUrl,"api/category/child"))};var a=function(o){return t.post("{0}/{1}".format(e.rootUrl,"api/category"),o,{headers:{"Content-Type":"application/json"}})};var i=function(o){return t.delete("{0}/{1}/{2}".format(e.rootUrl,"api/category",o))};var s=function(o){return t.put("{0}/{1}/{2}".format(e.rootUrl,"api/category",o._id),o,{headers:{"Content-Type":"application/json"}})};return{getCategoryList:o,getRootCategory:r,createCategory:a,removeCategory:i,updateCategory:s,getchildCategory:n}}})();(function(){angular.module("lomaApp").service("questionService",t);t.$inject=["$http","LOMA_CONFIG"];function t(t,e){this.getQuestionById=function(o){return t.get("{0}/{1}/{2}".format(e.rootUrl,"api/question",o))};this.getQuestionList=function(o,r){o=o||1;r=r||10;return t.get("{0}/{1}?page={2}&size={3}".format(e.rootUrl,"api/question",o,r))};this.createQuestion=function(o){return t.post("{0}/{1}".format(e.rootUrl,"api/question"),o,{headers:{"Content-Type":"application/json"}})};this.updateOption=function(o){return t.put("{0}/{1}/{2}".format(e.rootUrl,"api/question/option",o._id),o,{headers:{"Content-Type":"application/json"}})};this.updateQuestion=function(o){return t.put("{0}/{1}/{2}".format(e.rootUrl,"api/question",o._id),o,{headers:{"Content-Type":"application/json"}})};this.removeQuestion=function(o){return t.delete("{0}/{1}/{2}".format(e.rootUrl,"api/question",o))}}})();(function(){angular.module("lomaApp").service("examService",t);t.$inject=["$http","LOMA_CONFIG"];function t(t,e){this.getQuestionsByCategory=function(o){return t.get("{0}/{1}/{2}".format(e.rootUrl,"api/exam/question",o))};this.createExamRecord=function(o){return t.post("{0}/{1}".format(e.rootUrl,"api/exam/record"),o,{headers:{"Content-Type":"application/json"}})};this.getExamRecords=function(o,r){o=o||1;r=r||10;return t.get("{0}/{1}?page={2}&size={3}".format(e.rootUrl,"api/exam/record",o,r))};this.getReviewRcord=function(o){return t.get("{0}/{1}/{2}".format(e.rootUrl,"api/exam/review",o))}}})();(function(){angular.module("lomaApp").service("popupService",["$uibModal",function(t){var e={animation:true,backdrop:true,keyboard:true,templateUrl:"/tmp/common/views/modal.view.html"};var o={closeButtonText:"Close",actionButtonText:"OK",headerText:"Proceed?",bodyText:"Perform this action?"};this.showModal=function(t,e){t=t||{};t.backdrop="static";return this.show(t,e)};this.showDialog=function(o){o=o||{};o.backdrop="static";o.size="sm";o.templateUrl="/tmp/common/views/dialog.view.html";var r={};angular.extend(r,e,o);this.dialogInstance=t.open(r);return this.dialogInstance};this.closeDialog=function(){this.dialogInstance.dismiss("cancel")};this.show=function(r,n){var a={};var i={};angular.extend(a,e,r);angular.extend(i,o,n);if(!a.controller){s.$inject=["$scope","$uibModalInstance"];function s(t,e){t.modalOptions=i;t.modalOptions.ok=function(t){e.close(t)};t.modalOptions.close=function(){e.dismiss("cancel")}}a.controller=s}return t.open(a).result}}])})();(function(){angular.module("lomaApp").service("commonService",t);t.$inject=["_"];function t(t){var e=function(e){return t.isEmpty(e)||e===null||t.isUndefined(e)};return{isEmptyOrNull:e}}})();